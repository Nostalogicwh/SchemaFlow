# SchemaFlow v0.5.1 å®æ–½è®¡åˆ’

> **ç‰ˆæœ¬:** v0.5.1  
> **ç›®æ ‡:** ä¿®å¤æ ¸å¿ƒåŠŸèƒ½ç¼ºé™·å¹¶å¢å¼ºAIèƒ½åŠ›  
> **é¢„è®¡å·¥æœŸ:** 7-10å¤©  
> **æœ€åæ›´æ–°:** 2026-02-22

---

## ğŸ“‹ ä»»åŠ¡æ€»è§ˆ

### åŸæœ‰ä»»åŠ¡ (10ä¸ª)

| åºå· | ä»»åŠ¡ | ä¼˜å…ˆçº§ | ç±»å‹ | é¢„è®¡å·¥æ—¶ |
|------|------|--------|------|----------|
| 1 | å·¥ä½œæµæ–°å»ºå¼¹çª—consoleæ®‹ç•™ | P2 | å‰ç«¯ä¿®å¤ | 0.5å¤© |
| 2 | ä¾§è¾¹æ é»‘è¾¹æ ·å¼ä¿®å¤ | P2 | å‰ç«¯æ ·å¼ | 0.5å¤© |
| 3 | å¼¹çª—æé†’è¶…å‡ºæ˜¾ç¤ºèŒƒå›´ | P2 | å‰ç«¯ä¿®å¤ | 0.5å¤© |
| 4 | æ‰§è¡Œä¸­åœæ­¢æŒ‰é’®æ— æ•ˆ | P1 | åŠŸèƒ½ä¿®å¤ | 1å¤© |
| 5 | ç•Œé¢æœ¯è¯­ç»Ÿä¸€ | P2 | æ–‡æ¡ˆä¼˜åŒ– | 0.5å¤© |
| 6 | ç”¨æˆ·å¹²é¢„èŠ‚ç‚¹ä¿®å¤ | P0 | æ ¸å¿ƒåŠŸèƒ½ | 2å¤© |
| 7 | Pythonåç«¯æ—¥å¿—å¯è§ | P2 | åç«¯ä¼˜åŒ– | 0.5å¤© |
| 8 | ç­‰å¾…å…ƒç´ èŠ‚ç‚¹æ”¯æŒäººå·¥è®¾å®šæ—¶é—´ | P2 | åŠŸèƒ½å¢å¼º | 0.5å¤© |
| 9 | æ–°å¢'AIåˆ¤æ–­äººä¸ºå¹²é¢„'å¼€å…³ | P0 | AIèƒ½åŠ› | 2å¤© |
| 10 | èŠ‚ç‚¹å³ä¾§æ— æ³•æ‹–å‡ºè¿æ¥çº¿ | P1 | äº¤äº’ä¿®å¤ | 1å¤© |

### æ–°å¢ä»»åŠ¡ (4ä¸ª)

| åºå· | ä»»åŠ¡ | ä¼˜å…ˆçº§ | ç±»å‹ | é¢„è®¡å·¥æ—¶ |
|------|------|--------|------|----------|
| 11 | ç›‘æ§é¢æ¿æ”¯æŒæ‹–æ‹½è°ƒæ•´å¤§å° | P2 | äº¤äº’ä¼˜åŒ– | 1å¤© |
| 12 | AIå®šä½ç›®æ ‡åŠŸèƒ½é‡æ„ | P0 | AIèƒ½åŠ› | 2å¤© |
| 13 | ç»Ÿä¸€æ¨¡å‹é…ç½®ç®¡ç† | P1 | æ¶æ„ä¼˜åŒ– | 1å¤© |
| 14 | AIå®šä½ä½¿ç”¨æ— éšœç¢æ ‘ | P1 | æ€§èƒ½ä¼˜åŒ– | 1å¤© |

---

## ğŸ”¥ Phase 1: æ ¸å¿ƒåŠŸèƒ½ä¿®å¤ (P0/P1)

### Task 1: ç”¨æˆ·å¹²é¢„èŠ‚ç‚¹ä¿®å¤ [P0]

**é—®é¢˜æè¿°:**
- åå°æ¨¡å¼ç‚¹å‡»"ç»§ç»­æ‰§è¡Œ"æ— ååº”
- å‰å°æ¨¡å¼å¼¹çª—åœ¨åŸæµè§ˆå™¨æ‰“å¼€ï¼Œè€ŒéPlaywrightæµè§ˆå™¨

**å®æ–½æ­¥éª¤:**

#### Step 1: å®šä½é—®é¢˜ä»£ç 
```bash
# æœç´¢ç”¨æˆ·å¹²é¢„ç›¸å…³ä»£ç 
cd /Users/zwh/zwh/AICode/SchemaFlow
grep -r "user_input\|userInput" backend/ frontend/ --include="*.py" --include="*.ts" --include="*.tsx"
```

#### Step 2: ä¿®å¤åå°æ¨¡å¼
æ–‡ä»¶: `backend/engine/actions/control.py`

```python
# æ‰¾åˆ° user_input åŠ¨ä½œå®ç°
# ç¡®ä¿ç‚¹å‡»ç»§ç»­åèƒ½æ­£ç¡®å‘é€æ¶ˆæ¯ç»™WebSocket

# ä¿®å¤å‰ï¼ˆå‡è®¾çš„é—®é¢˜ï¼‰:
# if context.websocket:
#     await context.websocket.send_json({"type": "user_input_required"})
#     # ç¼ºå°‘ç­‰å¾…ç”¨æˆ·å“åº”çš„é€»è¾‘

# ä¿®å¤å:
async def user_input(context, message: str, **kwargs):
    """ç­‰å¾…ç”¨æˆ·è¾“å…¥"""
    await context.log("info", f"ç­‰å¾…ç”¨æˆ·è¾“å…¥: {message}")
    
    if context.websocket:
        # å‘é€ç”¨æˆ·è¾“å…¥è¯·æ±‚
        await context.websocket.send_json({
            "type": "user_input_required",
            "message": message,
            "execution_id": context.execution_id
        })
        
        # ç­‰å¾…ç”¨æˆ·å“åº”ï¼ˆè®¾ç½®è¶…æ—¶ï¼‰
        context._waiting_user_input = True
        context._user_input_value = None
        
        timeout = kwargs.get("timeout", 300)  # é»˜è®¤5åˆ†é’Ÿ
        start_time = time.time()
        
        while context._waiting_user_input:
            if time.time() - start_time > timeout:
                raise TimeoutError("ç­‰å¾…ç”¨æˆ·è¾“å…¥è¶…æ—¶")
            await asyncio.sleep(0.1)
        
        return context._user_input_value
    else:
        raise ValueError("WebSocketæœªè¿æ¥ï¼Œæ— æ³•å¤„ç†ç”¨æˆ·è¾“å…¥")
```

#### Step 3: ä¿®å¤å‰å°æ¨¡å¼å¼¹çª—ä½ç½®
æ–‡ä»¶: `backend/engine/browser_manager.py`

```python
# ç¡®ä¿å¼¹çª—åœ¨Playwrightæµè§ˆå™¨ä¸­æ‰“å¼€
# æ£€æŸ¥æ˜¯å¦æœ‰ target=_blank çš„å¤„ç†é€»è¾‘

async def handle_new_page(context, popup):
    """å¤„ç†æ–°é¡µé¢å¼¹å‡º"""
    # ç¡®ä¿æ–°é¡µé¢ä¹Ÿåœ¨Playwrightä¸Šä¸‹æ–‡ä¸­
    if not hasattr(context, '_pages'):
        context._pages = []
    context._pages.append(popup)
    
    # ç›‘å¬å¯¹è¯æ¡†
    popup.on("dialog", lambda dialog: asyncio.create_task(handle_dialog(context, dialog)))
```

#### Step 4: å‰ç«¯å¤„ç†ç»§ç»­æ‰§è¡Œæ¶ˆæ¯
æ–‡ä»¶: `frontend/src/hooks/useExecution.ts`

```typescript
// æ·»åŠ å¯¹ user_input_response æ¶ˆæ¯çš„å¤„ç†
const handleMessage = useCallback((message: WSMessage) => {
  switch (message.type) {
    case 'user_input_required':
      // æ˜¾ç¤ºç”¨æˆ·è¾“å…¥å¼¹çª—
      setUserInputRequest(message)
      break
    // ... å…¶ä»–case
  }
}, [])

// å‘é€ç”¨æˆ·å“åº”
const respondUserInput = useCallback((value: string) => {
  send({
    type: 'user_input_response',
    execution_id: executionState.executionId,
    value
  })
}, [send, executionState.executionId])
```

#### Step 5: WebSocketå¤„ç†ç”¨æˆ·å“åº”
æ–‡ä»¶: `backend/api/execution.py`

```python
elif message.get("type") == "user_input_response":
    execution_id = message.get("execution_id")
    value = message.get("value")
    
    if execution_id and execution_id in executor.active_executions:
        context = executor.active_executions[execution_id]
        context._user_input_value = value
        context._waiting_user_input = False
        await websocket.send_json({
            "type": "user_input_received",
            "execution_id": execution_id
        })
```

**éªŒè¯æ­¥éª¤:**
1. å¯åŠ¨åç«¯å’Œå‰ç«¯
2. åˆ›å»ºä¸€ä¸ªåŒ…å«"ç”¨æˆ·è¾“å…¥"èŠ‚ç‚¹çš„å·¥ä½œæµ
3. åå°æ¨¡å¼æµ‹è¯•ï¼šç‚¹å‡»æ‰§è¡Œï¼Œè§‚å¯Ÿå¼¹çª—ï¼Œç‚¹å‡»"ç»§ç»­"ï¼Œç¡®è®¤æ‰§è¡Œç»§ç»­
4. å‰å°æ¨¡å¼æµ‹è¯•ï¼šç¡®è®¤å¼¹çª—åœ¨Playwrightæµè§ˆå™¨çª—å£å†…æ‰“å¼€

---

### Task 2: AIå®šä½ç›®æ ‡åŠŸèƒ½é‡æ„ [P0]

**éœ€æ±‚æè¿°:**
1. è°ƒè¯•é€šè¿‡åä¿å­˜CSSé€‰æ‹©å™¨åˆ°èŠ‚ç‚¹é…ç½®
2. ç”¨æˆ·å¯æ§åˆ¶å½“CSSé€‰æ‹©å™¨å¤±æ•ˆæ—¶æ˜¯å¦å¯åŠ¨AIå®šä½
3. æ”¯æŒCSSé€‰æ‹©å™¨ä¼˜å…ˆã€AIå®šä½ä¸ºåå¤‡çš„æ¨¡å¼

**å®æ–½æ­¥éª¤:**

#### Step 1: åˆ›å»ºAIå®šä½æ¨¡å—ï¼ˆé‡æ„ï¼‰
æ–‡ä»¶: `backend/engine/ai_target_locator.py`

```python
"""AIç›®æ ‡å®šä½æ¨¡å— - ä½¿ç”¨LLMå®šä½é¡µé¢å…ƒç´ """
import json
import logging
from typing import Optional, Dict, Any, List
from playwright.async_api import Page, ElementHandle
from openai import AsyncOpenAI

logger = logging.getLogger(__name__)

# å®šä½æç¤ºè¯ï¼ˆä½¿ç”¨æ— éšœç¢æ ‘ï¼‰
TARGET_LOCATOR_PROMPT = """ä½ æ˜¯ä¸€ä¸ªç½‘é¡µå…ƒç´ å®šä½ä¸“å®¶ã€‚è¯·æ ¹æ®ç”¨æˆ·çš„è‡ªç„¶è¯­è¨€æè¿°ï¼Œä»é¡µé¢æ— éšœç¢æ ‘ä¸­æ‰¾åˆ°æœ€åŒ¹é…çš„å…ƒç´ ã€‚

æ— éšœç¢æ ‘æ ¼å¼ç¤ºä¾‹ï¼š
- role='button' name='æäº¤' id='submit-btn'
- role='link' name='ç™»å½•' href='/login'
- role='textbox' name='ç”¨æˆ·å' aria-label='è¯·è¾“å…¥ç”¨æˆ·å'

è¯·è¿”å›JSONæ ¼å¼ï¼š
{
    "selector": "CSSé€‰æ‹©å™¨",
    "confidence": 0-1ä¹‹é—´çš„ç½®ä¿¡åº¦,
    "reason": "é€‰æ‹©è¯¥å…ƒç´ çš„åŸå› ",
    "alternative_selectors": ["å¤‡é€‰é€‰æ‹©å™¨1", "å¤‡é€‰é€‰æ‹©å™¨2"]
}
"""


class AITargetLocator:
    """AIç›®æ ‡å®šä½å™¨"""
    
    def __init__(self, api_key: str, base_url: str = None, model: str = None):
        self.client = AsyncOpenAI(api_key=api_key, base_url=base_url)
        self.model = model or "gpt-4o-mini"
    
    async def locate_target(
        self,
        page: Page,
        description: str,
        use_accessibility_tree: bool = True
    ) -> Dict[str, Any]:
        """
        å®šä½ç›®æ ‡å…ƒç´ 
        
        Args:
            page: Playwrighté¡µé¢å¯¹è±¡
            description: ç”¨æˆ·æè¿°çš„ç›®æ ‡å…ƒç´ 
            use_accessibility_tree: æ˜¯å¦ä½¿ç”¨æ— éšœç¢æ ‘ï¼ˆæ¨èï¼‰
            
        Returns:
            åŒ…å«selectorç­‰ä¿¡æ¯çš„å­—å…¸
        """
        try:
            if use_accessibility_tree:
                # è·å–æ— éšœç¢æ ‘
                snapshot = await page.accessibility.snapshot()
                context = self._format_accessibility_tree(snapshot)
            else:
                # å›é€€åˆ°HTML
                context = await page.content()
                context = context[:6000]  # æˆªæ–­
            
            response = await self.client.chat.completions.create(
                model=self.model,
                messages=[
                    {"role": "system", "content": TARGET_LOCATOR_PROMPT},
                    {"role": "user", "content": f"""
ç›®æ ‡æè¿°: {description}

é¡µé¢ä¸Šä¸‹æ–‡:
{context}

è¯·å®šä½è¯¥å…ƒç´ å¹¶è¿”å›CSSé€‰æ‹©å™¨ã€‚
"""}
                ],
                response_format={"type": "json_object"}
            )
            
            result = json.loads(response.choices[0].message.content)
            logger.info(f"AIå®šä½ç»“æœ: {result}")
            return result
            
        except Exception as e:
            logger.error(f"AIå®šä½å¤±è´¥: {e}")
            return {
                "selector": None,
                "confidence": 0,
                "reason": f"å®šä½å¤±è´¥: {str(e)}",
                "alternative_selectors": []
            }
    
    def _format_accessibility_tree(self, snapshot: dict) -> str:
        """æ ¼å¼åŒ–æ— éšœç¢æ ‘ä¸ºå¯è¯»æ–‡æœ¬"""
        lines = []
        
        def traverse(node, depth=0):
            indent = "  " * depth
            role = node.get('role', '')
            name = node.get('name', '')
            
            if role and name:
                lines.append(f"{indent}- role='{role}' name='{name}'")
            elif role:
                lines.append(f"{indent}- role='{role}'")
            
            for child in node.get('children', []):
                traverse(child, depth + 1)
        
        traverse(snapshot)
        return "\n".join(lines[:200])  # é™åˆ¶è¡Œæ•°


class HybridElementLocator:
    """æ··åˆå®šä½å™¨ï¼šCSSé€‰æ‹©å™¨ä¼˜å…ˆï¼ŒAIä¸ºåå¤‡"""
    
    def __init__(self, ai_locator: AITargetLocator):
        self.ai_locator = ai_locator
        self.locator_cache = {}  # ç¼“å­˜å®šä½ç»“æœ
    
    async def find_element(
        self,
        page: Page,
        css_selector: str = None,
        ai_description: str = None,
        fallback_to_ai: bool = True,
        confidence_threshold: float = 0.7
    ) -> Optional[ElementHandle]:
        """
        æŸ¥æ‰¾å…ƒç´ ï¼ˆæ··åˆæ¨¡å¼ï¼‰
        
        Args:
            page: Playwrighté¡µé¢å¯¹è±¡
            css_selector: CSSé€‰æ‹©å™¨ï¼ˆä¼˜å…ˆä½¿ç”¨ï¼‰
            ai_description: AIå®šä½æè¿°ï¼ˆåå¤‡ä½¿ç”¨ï¼‰
            fallback_to_ai: CSSå¤±æ•ˆæ—¶æ˜¯å¦ä½¿ç”¨AIå®šä½
            confidence_threshold: AIå®šä½ç½®ä¿¡åº¦é˜ˆå€¼
            
        Returns:
            ElementHandleæˆ–None
        """
        # 1. å°è¯•CSSé€‰æ‹©å™¨
        if css_selector:
            try:
                element = await page.query_selector(css_selector)
                if element and await element.is_visible():
                    logger.info(f"CSSé€‰æ‹©å™¨å®šä½æˆåŠŸ: {css_selector}")
                    return element
                logger.warning(f"CSSé€‰æ‹©å™¨å¤±æ•ˆ: {css_selector}")
            except Exception as e:
                logger.warning(f"CSSé€‰æ‹©å™¨æŸ¥è¯¢å¤±è´¥: {e}")
        
        # 2. CSSå¤±æ•ˆï¼Œå°è¯•AIå®šä½
        if fallback_to_ai and ai_description:
            logger.info("CSSé€‰æ‹©å™¨å¤±æ•ˆï¼Œå¯ç”¨AIå®šä½...")
            
            result = await self.ai_locator.locate_target(page, ai_description)
            selector = result.get("selector")
            confidence = result.get("confidence", 0)
            
            if selector and confidence >= confidence_threshold:
                try:
                    element = await page.query_selector(selector)
                    if element and await element.is_visible():
                        logger.info(f"AIå®šä½æˆåŠŸ: {selector} (ç½®ä¿¡åº¦: {confidence})")
                        
                        # æ›´æ–°ç¼“å­˜
                        self.locator_cache[ai_description] = {
                            "selector": selector,
                            "confidence": confidence,
                            "timestamp": time.time()
                        }
                        
                        return element
                except Exception as e:
                    logger.error(f"AIå®šä½é€‰æ‹©å™¨æŸ¥è¯¢å¤±è´¥: {e}")
            else:
                logger.warning(f"AIå®šä½ç½®ä¿¡åº¦ä¸è¶³: {confidence}")
        
        return None
    
    async def debug_locate(
        self,
        page: Page,
        description: str
    ) -> Dict[str, Any]:
        """
        è°ƒè¯•å®šä½ï¼šå°è¯•AIå®šä½å¹¶è¿”å›ç»“æœä¾›ç”¨æˆ·ç¡®è®¤
        
        Returns:
            åŒ…å«å®šä½ç»“æœå’Œå»ºè®®çš„CSSé€‰æ‹©å™¨
        """
        result = await self.ai_locator.locate_target(page, description)
        
        # éªŒè¯é€‰æ‹©å™¨æ˜¯å¦æœ‰æ•ˆ
        if result.get("selector"):
            try:
                element = await page.query_selector(result["selector"])
                if element:
                    result["verified"] = True
                    # å°è¯•è·å–æ›´ç¨³å®šçš„é€‰æ‹©å™¨
                    result["suggested_selector"] = await self._generate_stable_selector(
                        page, element
                    )
                else:
                    result["verified"] = False
            except:
                result["verified"] = False
        
        return result
    
    async def _generate_stable_selector(
        self,
        page: Page,
        element: ElementHandle
    ) -> str:
        """ç”Ÿæˆç¨³å®šçš„é€‰æ‹©å™¨"""
        # å°è¯•æŒ‰ä¼˜å…ˆçº§ç”Ÿæˆé€‰æ‹©å™¨
        selectors = []
        
        # 1. ID
        element_id = await element.get_attribute("id")
        if element_id:
            selectors.append(f"#{element_id}")
        
        # 2. ç±»å
        class_name = await element.get_attribute("class")
        if class_name:
            classes = class_name.split()[:2]  # å–å‰ä¸¤ä¸ªç±»å
            selectors.append("." + ".".join(classes))
        
        # 3. data-testid
        test_id = await element.get_attribute("data-testid")
        if test_id:
            selectors.append(f'[data-testid="{test_id}"]')
        
        # 4. aria-label
        aria_label = await element.get_attribute("aria-label")
        if aria_label:
            selectors.append(f'[aria-label="{aria_label}"]')
        
        # è¿”å›æœ€ç®€çŸ­çš„é€‰æ‹©å™¨
        return min(selectors, key=len) if selectors else ""
```

#### Step 2: ä¿®æ”¹AIåŠ¨ä½œä½¿ç”¨æ··åˆå®šä½å™¨
æ–‡ä»¶: `backend/engine/actions/ai_action.py`

```python
from engine.ai_target_locator import AITargetLocator, HybridElementLocator

async def ai_action(
    context,
    action: str,  # "click", "input", "extract"
    target_description: str,
    css_selector: str = None,  # ç”¨æˆ·ä¿å­˜çš„é€‰æ‹©å™¨
    ai_config: dict = None,
    **kwargs
):
    """
    AIé©±åŠ¨çš„é¡µé¢æ“ä½œ
    
    Args:
        action: æ“ä½œç±»å‹
        target_description: ç›®æ ‡å…ƒç´ çš„è‡ªç„¶è¯­è¨€æè¿°
        css_selector: ç”¨æˆ·ä¿å­˜çš„CSSé€‰æ‹©å™¨
        ai_config: AIé…ç½®
            - fallback_to_ai: CSSå¤±æ•ˆæ—¶æ˜¯å¦å¯ç”¨AIå®šä½
            - confidence_threshold: AIå®šä½ç½®ä¿¡åº¦é˜ˆå€¼
            - auto_save_selector: æ˜¯å¦è‡ªåŠ¨ä¿å­˜æˆåŠŸå®šä½çš„é€‰æ‹©å™¨
    """
    ai_config = ai_config or {}
    fallback_to_ai = ai_config.get("fallback_to_ai", True)
    confidence_threshold = ai_config.get("confidence_threshold", 0.7)
    auto_save_selector = ai_config.get("auto_save_selector", True)
    
    # åˆå§‹åŒ–å®šä½å™¨
    locator = HybridElementLocator(
        AITargetLocator(
            api_key=context.settings["ai"]["api_key"],
            base_url=context.settings["ai"].get("base_url"),
            model=context.settings["ai"].get("models", {}).get("locator", "gpt-4o-mini")
        )
    )
    
    # æŸ¥æ‰¾å…ƒç´ 
    element = await locator.find_element(
        context.page,
        css_selector=css_selector,
        ai_description=target_description,
        fallback_to_ai=fallback_to_ai,
        confidence_threshold=confidence_threshold
    )
    
    if not element:
        raise ValueError(f"æ— æ³•å®šä½ç›®æ ‡å…ƒç´ : {target_description}")
    
    # æ‰§è¡Œæ“ä½œ
    if action == "click":
        await element.click()
    elif action == "input":
        text = kwargs.get("text", "")
        await element.fill(text)
    elif action == "extract":
        return await element.inner_text()
    
    # å¦‚æœéœ€è¦è‡ªåŠ¨ä¿å­˜é€‰æ‹©å™¨ï¼Œä¸”ä½¿ç”¨äº†AIå®šä½
    if auto_save_selector and not css_selector:
        # é€šçŸ¥å‰ç«¯æ›´æ–°é…ç½®
        if context.websocket:
            await context.websocket.send_json({
                "type": "ai_locator_selector_found",
                "node_id": context.current_node_id,
                "suggested_selector": await locator._generate_stable_selector(
                    context.page, element
                )
            })
```

#### Step 3: å‰ç«¯æ·»åŠ AIå®šä½é…ç½®UI
æ–‡ä»¶: `frontend/src/components/FlowEditor/panels/NodePanel.tsx`

```typescript
const AILocationConfig = ({ params, onChange }) => {
  const aiConfig = params?.ai_config || {}
  
  return (
    <div className="space-y-4 border-t pt-4 mt-4">
      <div className="flex items-center justify-between">
        <label className="text-sm font-medium flex items-center gap-2">
          <Target className="w-4 h-4 text-blue-500" />
          AIæ™ºèƒ½å®šä½
        </label>
        <Switch
          checked={aiConfig.enabled ?? true}
          onCheckedChange={(checked) => 
            onChange({
              ...params,
              ai_config: { ...aiConfig, enabled: checked }
            })
          }
        />
      </div>
      
      {aiConfig.enabled && (
        <div className="space-y-3 pl-6">
          {/* ç›®æ ‡æè¿° */}
          <div>
            <label className="block text-sm font-medium mb-1">
              ç›®æ ‡æè¿°
            </label>
            <Textarea
              value={params.target_description || ''}
              onChange={(e) => onChange({
                ...params,
                target_description: e.target.value
              })}
              placeholder="æè¿°è¦å®šä½çš„å…ƒç´ ï¼Œå¦‚'è“è‰²çš„æäº¤æŒ‰é’®'"
              rows={2}
            />
          </div>
          
          {/* CSSé€‰æ‹©å™¨ï¼ˆå¯ç¼–è¾‘ï¼‰ */}
          <div>
            <label className="block text-sm font-medium mb-1">
              CSSé€‰æ‹©å™¨
              <span className="text-xs text-gray-400 ml-1">ï¼ˆè°ƒè¯•é€šè¿‡åè‡ªåŠ¨å¡«å……ï¼‰</span>
            </label>
            <div className="flex gap-2">
              <Input
                value={params.css_selector || ''}
                onChange={(e) => onChange({
                  ...params,
                  css_selector: e.target.value
                })}
                placeholder="#submit-btn æˆ– .btn-primary"
              />
              <Button
                variant="outline"
                size="sm"
                onClick={() => openDebugModal(params)}
              >
                <Bug className="w-4 h-4" />
                è°ƒè¯•
              </Button>
            </div>
          </div>
          
          {/* AIåå¤‡é€‰é¡¹ */}
          <div className="space-y-2">
            <div className="flex items-center gap-2">
              <Switch
                checked={aiConfig.fallback_to_ai ?? true}
                onCheckedChange={(checked) => onChange({
                  ...params,
                  ai_config: { ...aiConfig, fallback_to_ai: checked }
                })}
              />
              <label className="text-sm">
                CSSé€‰æ‹©å™¨å¤±æ•ˆæ—¶å¯ç”¨AIå®šä½
              </label>
            </div>
            
            <div className="flex items-center gap-2">
              <Switch
                checked={aiConfig.auto_save_selector ?? true}
                onCheckedChange={(checked) => onChange({
                  ...params,
                  ai_config: { ...aiConfig, auto_save_selector: checked }
                })}
              />
              <label className="text-sm">
                è‡ªåŠ¨ä¿å­˜AIå®šä½æˆåŠŸçš„é€‰æ‹©å™¨
              </label>
            </div>
          </div>
          
          {/* ç½®ä¿¡åº¦é˜ˆå€¼ */}
          <div>
            <label className="block text-sm font-medium mb-1">
              AIå®šä½ç½®ä¿¡åº¦é˜ˆå€¼: {aiConfig.confidence_threshold ?? 0.7}
            </label>
            <Slider
              value={[aiConfig.confidence_threshold ?? 0.7]}
              onValueChange={([val]) => onChange({
                ...params,
                ai_config: { ...aiConfig, confidence_threshold: val }
              })}
              min={0.3}
              max={1}
              step={0.1}
            />
          </div>
        </div>
      )}
    </div>
  )
}
```

#### Step 4: åˆ›å»ºè°ƒè¯•å¼¹çª—ç»„ä»¶
æ–‡ä»¶: `frontend/src/components/FlowEditor/DebugLocatorModal.tsx`

```typescript
import { useState } from 'react'
import { Modal } from '@/components/ui/Modal'
import { Button } from '@/components/ui/Button'
import { useExecution } from '@/hooks/useExecution'

interface DebugLocatorModalProps {
  isOpen: boolean
  onClose: () => void
  nodeParams: any
  onSelectorConfirmed: (selector: string) => void
}

export function DebugLocatorModal({
  isOpen,
  onClose,
  nodeParams,
  onSelectorConfirmed
}: DebugLocatorModalProps) {
  const [isDebugging, setIsDebugging] = useState(false)
  const [debugResult, setDebugResult] = useState<any>(null)
  const { executeDebug } = useExecution()
  
  const handleDebug = async () => {
    setIsDebugging(true)
    try {
      const result = await executeDebug({
        action: 'ai_locate',
        description: nodeParams.target_description,
        url: nodeParams.target_url
      })
      setDebugResult(result)
    } catch (e) {
      console.error('è°ƒè¯•å¤±è´¥:', e)
    } finally {
      setIsDebugging(false)
    }
  }
  
  return (
    <Modal isOpen={isOpen} onClose={onClose} title="AIå®šä½è°ƒè¯•" size="lg">
      <div className="space-y-4 p-4">
        <div className="bg-gray-50 p-4 rounded-lg">
          <p className="text-sm font-medium">ç›®æ ‡æè¿°</p>
          <p className="text-gray-600">{nodeParams.target_description}</p>
        </div>
        
        <Button onClick={handleDebug} disabled={isDebugging}>
          {isDebugging ? 'è°ƒè¯•ä¸­...' : 'å¼€å§‹è°ƒè¯•'}
        </Button>
        
        {debugResult && (
          <div className="space-y-3">
            <div className={`p-4 rounded-lg ${
              debugResult.verified ? 'bg-green-50' : 'bg-yellow-50'
            }`}>
              <div className="flex items-center gap-2 mb-2">
                {debugResult.verified ? (
                  <CheckCircle className="w-5 h-5 text-green-600" />
                ) : (
                  <AlertCircle className="w-5 h-5 text-yellow-600" />
                )}
                <span className="font-medium">
                  {debugResult.verified ? 'å®šä½æˆåŠŸ' : 'å®šä½æœªéªŒè¯'}
                </span>
              </div>
              
              <div className="space-y-2 text-sm">
                <p><strong>AIå»ºè®®çš„é€‰æ‹©å™¨:</strong> {debugResult.selector}</p>
                <p><strong>ç½®ä¿¡åº¦:</strong> {(debugResult.confidence * 100).toFixed(1)}%</p>
                <p><strong>åŸå› :</strong> {debugResult.reason}</p>
                
                {debugResult.suggested_selector && (
                  <p><strong>æ¨èCSSé€‰æ‹©å™¨:</strong> {debugResult.suggested_selector}</p>
                )}
              </div>
            </div>
            
            {debugResult.verified && (
              <div className="flex justify-end gap-2">
                <Button variant="secondary" onClick={onClose}>
                  å–æ¶ˆ
                </Button>
                <Button onClick={() => {
                  onSelectorConfirmed(debugResult.suggested_selector || debugResult.selector)
                  onClose()
                }}>
                  ä¿å­˜é€‰æ‹©å™¨
                </Button>
              </div>
            )}
          </div>
        )}
      </div>
    </Modal>
  )
}
```

**éªŒè¯æ­¥éª¤:**
1. åœ¨AIåŠ¨ä½œèŠ‚ç‚¹ä¸­é…ç½®ç›®æ ‡æè¿°
2. ç‚¹å‡»"è°ƒè¯•"æŒ‰é’®ï¼ŒéªŒè¯AIèƒ½æ­£ç¡®æ‰¾åˆ°å…ƒç´ 
3. ä¿å­˜CSSé€‰æ‹©å™¨åï¼Œå†æ¬¡æ‰§è¡Œæ—¶ä½¿ç”¨CSSé€‰æ‹©å™¨ç›´æ¥å®šä½
4. ä¿®æ”¹é¡µé¢ä½¿CSSé€‰æ‹©å™¨å¤±æ•ˆï¼ŒéªŒè¯AIåå¤‡å®šä½å¯åŠ¨
5. å…³é—­"fallback_to_ai"é€‰é¡¹ï¼ŒéªŒè¯CSSå¤±æ•ˆæ—¶æŠ¥é”™è€Œéä½¿ç”¨AI

---

### Task 3: æ‰§è¡Œä¸­åœæ­¢æŒ‰é’®æ— æ•ˆ [P1]

**é—®é¢˜æè¿°:**
å·¥ä½œæµæ‰§è¡Œè¿‡ç¨‹ä¸­ç‚¹å‡»åœæ­¢æŒ‰é’®æ— æ³•ç»ˆæ­¢æ‰§è¡Œã€‚

**å®æ–½æ­¥éª¤:**

#### Step 1: æ£€æŸ¥ç°æœ‰åœæ­¢é€»è¾‘
æ–‡ä»¶: `backend/engine/executor.py`

```python
# æŸ¥æ‰¾ç°æœ‰çš„åœæ­¢é€»è¾‘
# é€šå¸¸åº”è¯¥æœ‰ä¸€ä¸ª cancellation æ ‡å¿—æˆ–æ–¹æ³•

class WorkflowExecutor:
    def __init__(self):
        self.active_executions: Dict[str, ExecutionContext] = {}
        self._cancellation_flags: Dict[str, bool] = {}
    
    async def stop_execution(self, execution_id: str):
        """åœæ­¢æ‰§è¡Œ"""
        if execution_id in self.active_executions:
            context = self.active_executions[execution_id]
            context._cancelled = True
            self._cancellation_flags[execution_id] = True
            
            # å…³é—­æµè§ˆå™¨
            if context.browser:
                try:
                    await context.browser.close()
                except:
                    pass
            
            await context.log("info", "æ‰§è¡Œå·²è¢«ç”¨æˆ·åœæ­¢")
```

#### Step 2: åœ¨æ‰§è¡Œå¾ªç¯ä¸­æ£€æŸ¥å–æ¶ˆæ ‡å¿—
```python
async def _run_workflow(self, context):
    """è¿è¡Œå·¥ä½œæµä¸»å¾ªç¯"""
    for node in workflow_nodes:
        # æ£€æŸ¥æ˜¯å¦è¢«å–æ¶ˆ
        if getattr(context, '_cancelled', False):
            await context.log("info", f"èŠ‚ç‚¹ {node['id']} æ‰§è¡Œå‰æ£€æµ‹åˆ°å–æ¶ˆä¿¡å·")
            break
        
        try:
            await self._execute_node(context, node)
        except Exception as e:
            if getattr(context, '_cancelled', False):
                await context.log("info", "æ‰§è¡Œè¢«å–æ¶ˆ")
                break
            raise
```

#### Step 3: å‰ç«¯å‘é€åœæ­¢æ¶ˆæ¯
æ–‡ä»¶: `frontend/src/hooks/useExecution.ts`

```typescript
const stopExecution = useCallback(() => {
  const executionId = executionState.executionId
  if (executionId) {
    send({
      type: 'stop_execution',
      execution_id: executionId
    })
  }
}, [send, executionState.executionId])
```

#### Step 4: WebSocketå¤„ç†åœæ­¢æ¶ˆæ¯
æ–‡ä»¶: `backend/api/execution.py`

```python
elif message.get("type") == "stop_execution":
    execution_id = message.get("execution_id")
    if execution_id:
        await executor.stop_execution(execution_id)
        await websocket.send_json({
            "type": "execution_stopped",
            "execution_id": execution_id
        })
```

---

### Task 4: èŠ‚ç‚¹å³ä¾§æ— æ³•æ‹–å‡ºè¿æ¥çº¿ [P1]

**é—®é¢˜æè¿°:**
åœ¨ç”»å¸ƒä¸Šï¼Œåªèƒ½ä»èŠ‚ç‚¹å·¦ä¾§æ‹–å‡ºè¿æ¥çº¿ï¼Œå³ä¾§æ— æ³•æ‹–å‡ºã€‚

**å®æ–½æ­¥éª¤:**

#### Step 1: æ£€æŸ¥èŠ‚ç‚¹Handleé…ç½®
æ–‡ä»¶: `frontend/src/components/FlowEditor/nodes/BaseNode.tsx` æˆ–ç›¸å…³èŠ‚ç‚¹ç»„ä»¶

```typescript
// ReactFlowçš„Handleç»„ä»¶ç”¨äºè¿æ¥ç‚¹
// éœ€è¦ç¡®ä¿å³ä¾§ä¹Ÿæœ‰Handle

import { Handle, Position } from 'reactflow'

const BaseNode = ({ data, isConnectable }) => {
  return (
    <div className="node-container">
      {/* å·¦ä¾§è¾“å…¥ */}
      <Handle
        type="target"
        position={Position.Left}
        isConnectable={isConnectable}
      />
      
      {/* èŠ‚ç‚¹å†…å®¹ */}
      <div className="node-content">
        {data.label}
      </div>
      
      {/* å³ä¾§è¾“å‡º - ç¡®ä¿è¿™ä¸ªå­˜åœ¨ */}
      <Handle
        type="source"
        position={Position.Right}
        isConnectable={isConnectable}
      />
    </div>
  )
}
```

#### Step 2: æ£€æŸ¥æ‰€æœ‰èŠ‚ç‚¹ç±»å‹
```bash
# æ£€æŸ¥æ‰€æœ‰èŠ‚ç‚¹ç»„ä»¶æ˜¯å¦éƒ½æœ‰å³ä¾§Handle
cd /Users/zwh/zwh/AICode/SchemaFlow/frontend
grep -r "Handle.*Position.Right" src/components/FlowEditor/nodes/
grep -r "type=\"source\"" src/components/FlowEditor/nodes/
```

#### Step 3: ä¿®å¤ç¼ºå¤±çš„Handle
å¯¹äºæ¯ä¸ªèŠ‚ç‚¹ç»„ä»¶ï¼Œæ·»åŠ æˆ–ä¿®å¤å³ä¾§source Handle:

```typescript
// åœ¨èŠ‚ç‚¹ç»„ä»¶çš„å³ä¾§æ·»åŠ 
<Handle
  type="source"
  position={Position.Right}
  id="right-source"  // å¯é€‰çš„ID
  isConnectable={isConnectable}
  className="w-3 h-3 bg-blue-500"
/>
```

---

## ğŸ¨ Phase 2: å‰ç«¯äº¤äº’ä¸æ ·å¼ä¼˜åŒ– (P2)

### Task 5: ç›‘æ§é¢æ¿æ”¯æŒæ‹–æ‹½è°ƒæ•´å¤§å°

**éœ€æ±‚æè¿°:**
æœ€å³ä¾§çš„ç›‘æ§é¢æ¿ï¼ˆå·¥ä½œæµæ‰§è¡Œã€æˆªå›¾ã€æ—¥å¿—ï¼‰æ”¯æŒç”¨æˆ·æ‹–æ‹½è°ƒæ•´çª—å£å¤§å°ã€‚

**å®æ–½æ­¥éª¤:**

#### Step 1: å®‰è£…resizableåº“
```bash
cd /Users/zwh/zwh/AICode/SchemaFlow/frontend
npm install re-resizable
```

#### Step 2: ä¿®æ”¹ExecutionPanelç»„ä»¶
æ–‡ä»¶: `frontend/src/components/ExecutionPanel/index.tsx`

```typescript
import { Resizable } from 're-resizable'
import { useState, useEffect } from 'react'

export function ExecutionPanel() {
  const [width, setWidth] = useState(400)  // é»˜è®¤å®½åº¦
  const { viewMode } = useExecutionStore()
  
  // ä»localStorageè¯»å–ä¿å­˜çš„å®½åº¦
  useEffect(() => {
    const saved = localStorage.getItem('executionPanelWidth')
    if (saved) {
      setWidth(parseInt(saved))
    }
  }, [])
  
  const handleResizeStop = (e, direction, ref, d) => {
    const newWidth = width + d.width
    setWidth(newWidth)
    localStorage.setItem('executionPanelWidth', newWidth.toString())
  }
  
  return (
    <Resizable
      size={{ width, height: '100%' }}
      onResizeStop={handleResizeStop}
      enable={{
        left: true,  // åªå…è®¸ä»å·¦ä¾§æ‹–æ‹½è°ƒæ•´
        right: false,
        top: false,
        bottom: false,
        topLeft: false,
        topRight: false,
        bottomLeft: false,
        bottomRight: false
      }}
      minWidth={300}
      maxWidth={800}
      handleClasses={{
        left: 'resize-handle-left'
      }}
    >
      <div className="h-full flex flex-col bg-white border-l border-gray-200">
        {/* æ‹–æ‹½æ‰‹æŸ„æ ·å¼ */}
        <style>{`
          .resize-handle-left {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            cursor: col-resize;
            background: transparent;
            transition: background 0.2s;
          }
          .resize-handle-left:hover {
            background: #3b82f6;
          }
        `}</style>
        
        {/* é¢æ¿å†…å®¹ */}
        <div className="flex-1 overflow-hidden">
          {viewMode === 'debug' ? <DebugModeLayout /> : <CompactModeLayout />}
        </div>
      </div>
    </Resizable>
  )
}
```

#### Step 3: åˆ›å»ºå¯è°ƒæ•´å¤§å°çš„åˆ†åŒºï¼ˆæˆªå›¾ã€æ—¥å¿—ï¼‰
```typescript
const CompactModeLayout = () => {
  const [screenshotHeight, setScreenshotHeight] = useState(300)
  
  return (
    <div className="flex flex-col h-full">
      {/* èŠ‚ç‚¹åˆ—è¡¨ - å›ºå®šé«˜åº¦ */}
      <div className="h-1/3 overflow-y-auto p-4 border-b border-gray-200">
        <h3 className="text-sm font-medium mb-2">èŠ‚ç‚¹åˆ—è¡¨</h3>
        <NodeList />
      </div>
      
      {/* å®æ—¶æˆªå›¾ - å¯è°ƒæ•´é«˜åº¦ */}
      <Resizable
        size={{ width: '100%', height: screenshotHeight }}
        onResizeStop={(e, direction, ref, d) => {
          setScreenshotHeight(screenshotHeight + d.height)
        }}
        enable={{ top: true, bottom: true }}
        minHeight={150}
        maxHeight={500}
      >
        <div className="h-full border-b border-gray-200 flex flex-col">
          <h3 className="text-sm font-medium p-2 bg-gray-50">å®æ—¶æˆªå›¾</h3>
          <div className="flex-1 overflow-hidden">
            <ScreenshotDisplay />
          </div>
        </div>
      </Resizable>
      
      {/* æ—¥å¿— - è‡ªé€‚åº”å‰©ä½™ç©ºé—´ */}
      <div className="flex-1 flex flex-col min-h-0">
        <h3 className="text-sm font-medium p-2 bg-gray-50">æ—¥å¿—</h3>
        <div className="flex-1 overflow-auto">
          <LogDisplay />
        </div>
      </div>
    </div>
  )
}
```

---

### Task 6: å·¥ä½œæµæ–°å»ºå¼¹çª—consoleæ®‹ç•™

**å®æ–½æ­¥éª¤:**

#### Step 1: æŸ¥æ‰¾consoleè¯­å¥
```bash
cd /Users/zwh/zwh/AICode/SchemaFlow/frontend
grep -rn "console.log\|console.error\|console.warn" src/components/WorkflowList/
```

#### Step 2: åˆ é™¤æˆ–æ›¿æ¢console
```typescript
// åˆ é™¤æ‰€æœ‰è°ƒè¯•ç”¨çš„console
// å¦‚æœ‰å¿…è¦ï¼Œä½¿ç”¨loggeræ›¿ä»£

// Before:
console.log("åˆ›å»ºå·¥ä½œæµ", workflowData)

// After:
// åˆ é™¤æˆ–ä½¿ç”¨logger
import logger from '@/utils/logger'
logger.debug("åˆ›å»ºå·¥ä½œæµ", workflowData)
```

---

### Task 7: ä¾§è¾¹æ é»‘è¾¹æ ·å¼ä¿®å¤

**å®æ–½æ­¥éª¤:**

#### Step 1: å®šä½é»‘è¾¹æ ·å¼
```bash
cd /Users/zwh/zwh/AICode/SchemaFlow/frontend
grep -rn "border-black\|border-gray-800\|border-gray-900" src/components/
```

#### Step 2: ç»Ÿä¸€æ›¿æ¢ä¸ºæµ…è‰²è¾¹æ¡†
```typescript
// æ–‡ä»¶: src/components/FlowEditor/panels/NodePanel.tsx
// æ–‡ä»¶: src/components/FlowEditor/panels/Toolbar.tsx
// æ–‡ä»¶: src/components/ExecutionPanel/index.tsx

// æ›¿æ¢å‰:
className="border border-black"
className="border-l border-black"

// æ›¿æ¢å:
className="border border-gray-200"
className="border-l border-gray-200 shadow-sm"
// æˆ–ä½¿ç”¨é˜´å½±ä»£æ›¿è¾¹æ¡†
className="shadow-md"
```

#### Step 3: ç»Ÿä¸€è®¾è®¡è§„èŒƒ
```typescript
// å»ºè®®ç»Ÿä¸€ä½¿ç”¨ä»¥ä¸‹æ ·å¼
const sidebarStyles = {
  border: "border-gray-200",
  shadow: "shadow-sm",
  bg: "bg-white"
}
```

---

### Task 8: å¼¹çª—æé†’è¶…å‡ºæ˜¾ç¤ºèŒƒå›´

**å®æ–½æ­¥éª¤:**

#### Step 1: æ£€æŸ¥å¼¹çª—ç»„ä»¶
```bash
# æŸ¥æ‰¾å¼¹çª—ç»„ä»¶
cd /Users/zwh/zwh/AICode/SchemaFlow/frontend
grep -rn "toast\|notification\|alert" src/components/ --include="*.tsx"
```

#### Step 2: ä¿®å¤å¼¹çª—å®šä½
```typescript
// ç¡®ä¿å¼¹çª—ä¸ä¼šè¶…å‡ºè§†å£
// ä½¿ç”¨ fixed å®šä½å¹¶è®¡ç®—ä½ç½®

const ToastContainer = () => {
  return (
    <div className="fixed top-4 left-1/2 transform -translate-x-1/2 z-50">
      {/* å¼¹çª—å†…å®¹ */}
    </div>
  )
}

// æˆ–ä½¿ç”¨æ›´å¥å£®çš„å®šä½åº“å¦‚ react-hot-toast
```

#### Step 3: æ·»åŠ è¾¹ç•Œæ£€æµ‹
```typescript
// å¦‚æœè‡ªå®šä¹‰å®ç°ï¼Œæ·»åŠ è¾¹ç•Œæ£€æµ‹
useEffect(() => {
  const checkPosition = () => {
    const rect = toastRef.current?.getBoundingClientRect()
    if (rect && rect.top < 0) {
      // è°ƒæ•´åˆ°è§†å£å†…
      setPosition({ top: 10 })
    }
  }
  
  checkPosition()
  window.addEventListener('resize', checkPosition)
  return () => window.removeEventListener('resize', checkPosition)
}, [])
```

---

### Task 9: ç•Œé¢æœ¯è¯­ç»Ÿä¸€

**æ›¿æ¢æ¸…å•:**

```bash
# æœç´¢æ‰€æœ‰"è¿è¡Œ"
cd /Users/zwh/zwh/AICode/SchemaFlow/frontend
grep -rn "è¿è¡Œ" src/ --include="*.tsx" --include="*.ts"

# éœ€è¦æ›¿æ¢çš„æœ¯è¯­:
# "è¿è¡Œ" â†’ "æ‰§è¡Œ" (å½“è¡¨ç¤ºexecuteåŠ¨ä½œæ—¶)
# "è¿è¡Œä¸­" â†’ "æ‰§è¡Œä¸­"
# "é‡æ–°è¿è¡Œ" â†’ "é‡æ–°æ‰§è¡Œ"
# "åœæ­¢è¿è¡Œ" â†’ "åœæ­¢æ‰§è¡Œ"
```

**æ³¨æ„:** ä¿ç•™"è¿è¡Œ"å½“è¡¨ç¤ºè¿è¡ŒçŠ¶æ€(running state)è€Œéæ‰§è¡ŒåŠ¨ä½œ(execute action)æ—¶ã€‚

---

## âš™ï¸ Phase 3: æ¶æ„ä¼˜åŒ–ä¸é…ç½®ç®¡ç† (P1/P2)

### Task 10: ç»Ÿä¸€æ¨¡å‹é…ç½®ç®¡ç†

**éœ€æ±‚æè¿°:**
ä¸è¦ç¡¬ç¼–ç æ¨¡å‹é€‰æ‹©ï¼Œæ”¹ä¸ºç»Ÿä¸€é…ç½®æ–‡ä»¶ç®¡ç†ï¼Œæ”¯æŒæŒ‰ä¸åŒåœºæ™¯é…ç½®å¤šä¸ªæ¨¡å‹ç±»å‹ã€‚

**å®æ–½æ­¥éª¤:**

#### Step 1: åˆ›å»ºæ¨¡å‹é…ç½®Schema
æ–‡ä»¶: `backend/config/ai_models.py`

```python
"""AIæ¨¡å‹é…ç½®ç®¡ç†"""
from typing import Dict, Any, Optional
from pydantic import BaseModel, Field


class ModelConfig(BaseModel):
    """å•ä¸ªæ¨¡å‹é…ç½®"""
    name: str
    provider: str  # "openai", "anthropic", "local"
    model_id: str  # "gpt-4", "claude-3", "llama-2"
    api_key: Optional[str] = None
    base_url: Optional[str] = None
    max_tokens: int = 2000
    temperature: float = 0.7
    timeout: int = 30
    
    # æ¨¡å‹èƒ½åŠ›æ ‡ç­¾
    capabilities: list[str] = Field(default_factory=list)
    # æˆæœ¬è¯„çº§ (1-5, 5æœ€è´µ)
    cost_level: int = 3
    # æ¨èä½¿ç”¨åœºæ™¯
    recommended_for: list[str] = Field(default_factory=list)


class AIModelRegistry:
    """AIæ¨¡å‹æ³¨å†Œè¡¨"""
    
    # é¢„å®šä¹‰çš„æ¨¡å‹é…ç½®æ¨¡æ¿
    PREDEFINED_MODELS = {
        "gpt-4o": ModelConfig(
            name="GPT-4o",
            provider="openai",
            model_id="gpt-4o",
            capabilities=["vision", "function_calling", "json_mode"],
            cost_level=5,
            recommended_for=["complex_reasoning", "vision_tasks", "precise_json"]
        ),
        "gpt-4o-mini": ModelConfig(
            name="GPT-4o Mini",
            provider="openai",
            model_id="gpt-4o-mini",
            capabilities=["vision", "json_mode"],
            cost_level=2,
            recommended_for=["quick_tasks", "high_volume", "simple_classification"]
        ),
        "claude-3-5-sonnet": ModelConfig(
            name="Claude 3.5 Sonnet",
            provider="anthropic",
            model_id="claude-3-5-sonnet-20241022",
            capabilities=["vision", "long_context"],
            cost_level=4,
            recommended_for=["long_context", "code_generation", "analysis"]
        ),
        "deepseek-chat": ModelConfig(
            name="DeepSeek Chat",
            provider="deepseek",
            model_id="deepseek-chat",
            capabilities=["json_mode"],
            cost_level=1,
            recommended_for=["cost_sensitive", "chinese_tasks"]
        ),
    }
    
    def __init__(self, config: dict):
        self.config = config
        self.models: Dict[str, ModelConfig] = {}
        self.scenarios: Dict[str, str] = {}  # åœºæ™¯ -> æ¨¡å‹å æ˜ å°„
        self._load_config()
    
    def _load_config(self):
        """ä»é…ç½®åŠ è½½æ¨¡å‹å’Œåœºæ™¯æ˜ å°„"""
        # åŠ è½½æ¨¡å‹å®šä¹‰
        models_config = self.config.get("models", {})
        for name, model_data in models_config.items():
            if name in self.PREDEFINED_MODELS:
                # åŸºäºé¢„å®šä¹‰æ¨¡å‹ï¼Œç”¨é…ç½®è¦†ç›–
                base = self.PREDEFINED_MODELS[name].dict()
                base.update(model_data)
                self.models[name] = ModelConfig(**base)
            else:
                # è‡ªå®šä¹‰æ¨¡å‹
                self.models[name] = ModelConfig(name=name, **model_data)
        
        # åŠ è½½åœºæ™¯æ˜ å°„
        self.scenarios = self.config.get("scenarios", {
            "default": "gpt-4o-mini",
            "intervention_detection": "gpt-4o-mini",
            "element_location": "gpt-4o-mini",
            "workflow_generation": "gpt-4o",
            "error_analysis": "gpt-4o",
            "vision_analysis": "gpt-4o"
        })
    
    def get_model(self, scenario: str = "default") -> ModelConfig:
        """è·å–åœºæ™¯å¯¹åº”çš„æ¨¡å‹é…ç½®"""
        model_name = self.scenarios.get(scenario, "default")
        if model_name not in self.models:
            raise ValueError(f"æœªæ‰¾åˆ°æ¨¡å‹é…ç½®: {model_name}")
        return self.models[model_name]
    
    def get_model_by_name(self, name: str) -> ModelConfig:
        """æŒ‰åç§°è·å–æ¨¡å‹é…ç½®"""
        if name not in self.models:
            raise ValueError(f"æœªæ‰¾åˆ°æ¨¡å‹é…ç½®: {name}")
        return self.models[name]
    
    def list_scenarios(self) -> Dict[str, str]:
        """åˆ—å‡ºæ‰€æœ‰åœºæ™¯å’Œå¯¹åº”çš„æ¨¡å‹"""
        return self.scenarios.copy()
    
    def update_scenario(self, scenario: str, model_name: str):
        """æ›´æ–°åœºæ™¯çš„æ¨¡å‹é…ç½®"""
        if model_name not in self.models:
            raise ValueError(f"æ¨¡å‹ä¸å­˜åœ¨: {model_name}")
        self.scenarios[scenario] = model_name
    
    def list_models(self) -> Dict[str, ModelConfig]:
        """åˆ—å‡ºæ‰€æœ‰å¯ç”¨æ¨¡å‹"""
        return self.models.copy()


# å…¨å±€æ³¨å†Œè¡¨å®ä¾‹
_model_registry: Optional[AIModelRegistry] = None


def init_model_registry(config: dict):
    """åˆå§‹åŒ–æ¨¡å‹æ³¨å†Œè¡¨"""
    global _model_registry
    _model_registry = AIModelRegistry(config)
    return _model_registry


def get_model_registry() -> AIModelRegistry:
    """è·å–æ¨¡å‹æ³¨å†Œè¡¨å®ä¾‹"""
    if _model_registry is None:
        raise RuntimeError("æ¨¡å‹æ³¨å†Œè¡¨æœªåˆå§‹åŒ–")
    return _model_registry
```

#### Step 2: é…ç½®æ–‡ä»¶ç¤ºä¾‹
æ–‡ä»¶: `backend/config/ai_config.yaml`

```yaml
# AIæ¨¡å‹é…ç½®æ–‡ä»¶

# æ¨¡å‹å®šä¹‰
models:
  gpt-4o:
    provider: openai
    model_id: gpt-4o
    api_key: ${OPENAI_API_KEY}
    max_tokens: 4000
    temperature: 0.7
    capabilities:
      - vision
      - function_calling
      - json_mode
    cost_level: 5
    recommended_for:
      - complex_reasoning
      - vision_tasks
      - precise_json
  
  gpt-4o-mini:
    provider: openai
    model_id: gpt-4o-mini
    api_key: ${OPENAI_API_KEY}
    max_tokens: 2000
    temperature: 0.5
    capabilities:
      - vision
      - json_mode
    cost_level: 2
    recommended_for:
      - quick_tasks
      - high_volume
      - simple_classification
  
  deepseek-chat:
    provider: deepseek
    model_id: deepseek-chat
    base_url: https://api.deepseek.com/v1
    api_key: ${DEEPSEEK_API_KEY}
    max_tokens: 2000
    temperature: 0.7
    capabilities:
      - json_mode
    cost_level: 1
    recommended_for:
      - cost_sensitive
      - chinese_tasks
  
  # æœ¬åœ°æ¨¡å‹ç¤ºä¾‹
  local-llama:
    provider: local
    model_id: llama2-7b
    base_url: http://localhost:8000/v1
    max_tokens: 1000
    temperature: 0.8
    capabilities: []
    cost_level: 1

# åœºæ™¯æ˜ å°„ï¼šå®šä¹‰ä¸åŒåŠŸèƒ½ä½¿ç”¨å“ªä¸ªæ¨¡å‹
scenarios:
  default: gpt-4o-mini
  intervention_detection: gpt-4o-mini      # AIå¹²é¢„æ£€æµ‹
  element_location: gpt-4o-mini            # å…ƒç´ å®šä½
  workflow_generation: gpt-4o              # å·¥ä½œæµç”Ÿæˆ
  error_analysis: gpt-4o                   # é”™è¯¯åˆ†æ
  vision_analysis: gpt-4o                  # è§†è§‰åˆ†æ
  code_generation: claude-3-5-sonnet       # ä»£ç ç”Ÿæˆ

# é™çº§ç­–ç•¥ï¼šå½“ä¸»æ¨¡å‹å¤±è´¥æ—¶ä½¿ç”¨çš„å¤‡ç”¨æ¨¡å‹
fallback:
  enabled: true
  max_retries: 2
  fallback_model: gpt-4o-mini
```

#### Step 3: ä¿®æ”¹AIè°ƒç”¨ä»£ç ä½¿ç”¨é…ç½®
æ–‡ä»¶: `backend/engine/ai_client.py`

```python
"""ç»Ÿä¸€çš„AIå®¢æˆ·ç«¯"""
from typing import Any, Dict, Optional
from openai import AsyncOpenAI
from config.ai_models import get_model_registry, ModelConfig


class AIClient:
    """ç»Ÿä¸€çš„AIå®¢æˆ·ç«¯ï¼Œæ”¯æŒå¤šæ¨¡å‹é…ç½®"""
    
    def __init__(self):
        self.registry = get_model_registry()
        self._clients: Dict[str, AsyncOpenAI] = {}
    
    def _get_client(self, model_config: ModelConfig) -> AsyncOpenAI:
        """è·å–æˆ–åˆ›å»ºOpenAIå®¢æˆ·ç«¯"""
        cache_key = f"{model_config.provider}:{model_config.base_url}"
        
        if cache_key not in self._clients:
            self._clients[cache_key] = AsyncOpenAI(
                api_key=model_config.api_key,
                base_url=model_config.base_url
            )
        
        return self._clients[cache_key]
    
    async def chat_completion(
        self,
        scenario: str,
        messages: list,
        response_format: Optional[Dict] = None,
        **kwargs
    ) -> str:
        """
        å‘é€èŠå¤©å®Œæˆè¯·æ±‚
        
        Args:
            scenario: ä½¿ç”¨åœºæ™¯ï¼ˆä»é…ç½®ä¸­æŸ¥æ‰¾å¯¹åº”æ¨¡å‹ï¼‰
            messages: æ¶ˆæ¯åˆ—è¡¨
            response_format: å“åº”æ ¼å¼
            **kwargs: è¦†ç›–é…ç½®çš„é¢å¤–å‚æ•°
        """
        model_config = self.registry.get_model(scenario)
        client = self._get_client(model_config)
        
        params = {
            "model": model_config.model_id,
            "messages": messages,
            "max_tokens": kwargs.get("max_tokens", model_config.max_tokens),
            "temperature": kwargs.get("temperature", model_config.temperature),
        }
        
        if response_format:
            params["response_format"] = response_format
        
        response = await client.chat.completions.create(**params)
        return response.choices[0].message.content
    
    async def chat_completion_with_fallback(
        self,
        scenario: str,
        messages: list,
        **kwargs
    ) -> str:
        """å¸¦é™çº§ç­–ç•¥çš„èŠå¤©å®Œæˆ"""
        try:
            return await self.chat_completion(scenario, messages, **kwargs)
        except Exception as e:
            # å°è¯•ä½¿ç”¨fallbackæ¨¡å‹
            fallback_config = self.registry.get_model("fallback")
            if fallback_config:
                client = self._get_client(fallback_config)
                params = {
                    "model": fallback_config.model_id,
                    "messages": messages,
                    "max_tokens": fallback_config.max_tokens,
                    "temperature": fallback_config.temperature,
                }
                response = await client.chat.completions.create(**params)
                return response.choices[0].message.content
            raise


# ä½¿ç”¨ç¤ºä¾‹
ai_client = AIClient()

# å¹²é¢„æ£€æµ‹ä½¿ç”¨è½»é‡çº§æ¨¡å‹
result = await ai_client.chat_completion(
    scenario="intervention_detection",
    messages=[...],
    response_format={"type": "json_object"}
)

# å·¥ä½œæµç”Ÿæˆä½¿ç”¨æ›´å¼ºçš„æ¨¡å‹
result = await ai_client.chat_completion(
    scenario="workflow_generation",
    messages=[...]
)
```

#### Step 4: å‰ç«¯æ¨¡å‹é…ç½®ç•Œé¢ï¼ˆå¯é€‰ï¼‰
æ–‡ä»¶: `frontend/src/components/Settings/ModelConfig.tsx`

```typescript
// æä¾›ç•Œé¢è®©ç”¨æˆ·æŸ¥çœ‹å’Œä¿®æ”¹æ¨¡å‹é…ç½®
export function ModelConfigPanel() {
  const { models, scenarios, updateScenario } = useModelConfig()
  
  return (
    <div className="space-y-6">
      <div>
        <h3 className="text-lg font-medium mb-4">åœºæ™¯æ¨¡å‹é…ç½®</h3>
        <div className="space-y-3">
          {Object.entries(scenarios).map(([scenario, modelName]) => (
            <div key={scenario} className="flex items-center justify-between p-3 bg-gray-50 rounded">
              <span className="text-sm font-medium">{getScenarioLabel(scenario)}</span>
              <select
                value={modelName}
                onChange={(e) => updateScenario(scenario, e.target.value)}
                className="text-sm border border-gray-300 rounded px-2 py-1"
              >
                {Object.entries(models).map(([name, model]) => (
                  <option key={name} value={name}>
                    {model.name} (æˆæœ¬ç­‰çº§: {model.cost_level})
                  </option>
                ))}
              </select>
            </div>
          ))}
        </div>
      </div>
    </div>
  )
}
```

---

### Task 11: Pythonåç«¯æ—¥å¿—å¯è§

**å®æ–½æ­¥éª¤:**

#### Step 1: æ£€æŸ¥æ—¥å¿—é…ç½®
æ–‡ä»¶: `backend/config.py` æˆ–æ—¥å¿—é…ç½®æ–‡ä»¶

```python
import logging
import sys

# ç¡®ä¿æ—¥å¿—è¾“å‡ºåˆ°stdout
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.StreamHandler(sys.stdout),  # è¾“å‡ºåˆ°æ§åˆ¶å°
        logging.FileHandler('app.log')      # åŒæ—¶å†™å…¥æ–‡ä»¶
    ]
)

# æˆ–è€…ä½¿ç”¨uvicornçš„æ—¥å¿—é…ç½®
if __name__ == "__main__":
    import uvicorn
    uvicorn.run(
        "main:app",
        host="0.0.0.0",
        port=8000,
        log_level="info",
        access_log=True
    )
```

#### Step 2: åœ¨å·¥ä½œæµæ‰§è¡Œä¸­æ·»åŠ æ—¥å¿—
æ–‡ä»¶: `backend/engine/executor.py`

```python
import logging

logger = logging.getLogger(__name__)

class WorkflowExecutor:
    async def execute(self, workflow, **kwargs):
        logger.info(f"å¼€å§‹æ‰§è¡Œå·¥ä½œæµ: {workflow.get('name', 'æœªå‘½å')}")
        
        try:
            # æ‰§è¡Œé€»è¾‘
            logger.info(f"å·¥ä½œæµæ‰§è¡Œå®Œæˆ")
        except Exception as e:
            logger.error(f"å·¥ä½œæµæ‰§è¡Œå¤±è´¥: {e}")
            raise
```

#### Step 3: éªŒè¯æ—¥å¿—è¾“å‡º
```bash
cd /Users/zwh/zwh/AICode/SchemaFlow/backend
python main.py
# è§‚å¯Ÿæ§åˆ¶å°æ˜¯å¦æœ‰æ—¥å¿—è¾“å‡º
```

---

### Task 12: ç­‰å¾…å…ƒç´ èŠ‚ç‚¹æ”¯æŒäººå·¥è®¾å®šæ—¶é—´

**å®æ–½æ­¥éª¤:**

#### Step 1: ä¿®æ”¹ç­‰å¾…å…ƒç´ èŠ‚ç‚¹é…ç½®
æ–‡ä»¶: `backend/engine/actions/control.py`

```python
async def wait_for_element(context, selector: str, **kwargs):
    """
    ç­‰å¾…å…ƒç´ å‡ºç°
    
    Args:
        selector: CSSé€‰æ‹©å™¨
        timeout: è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤30ç§’ï¼Œå¯ç”±ç”¨æˆ·é…ç½®
        visible: æ˜¯å¦è¦æ±‚å…ƒç´ å¯è§
    """
    timeout = kwargs.get("timeout", 30)  # ç”¨æˆ·å¯é…ç½®çš„timeout
    visible = kwargs.get("visible", True)
    
    await context.log("info", f"ç­‰å¾…å…ƒç´ : {selector}, è¶…æ—¶: {timeout}ç§’")
    
    try:
        if visible:
            await context.page.wait_for_selector(
                selector, 
                state="visible",
                timeout=timeout * 1000  # Playwrightä½¿ç”¨æ¯«ç§’
            )
        else:
            await context.page.wait_for_selector(
                selector,
                timeout=timeout * 1000
            )
        
        await context.log("info", f"å…ƒç´ å·²å‡ºç°: {selector}")
        return True
        
    except TimeoutError:
        await context.log("error", f"ç­‰å¾…å…ƒç´ è¶…æ—¶: {selector}")
        raise TimeoutError(f"ç­‰å¾…å…ƒç´  {selector} è¶…æ—¶ï¼ˆ{timeout}ç§’ï¼‰")
```

#### Step 2: å‰ç«¯æ·»åŠ è¶…æ—¶é…ç½®
æ–‡ä»¶: `frontend/src/components/FlowEditor/panels/NodePanel.tsx`

```typescript
// åœ¨ç­‰å¾…å…ƒç´ èŠ‚ç‚¹çš„é…ç½®ä¸­æ·»åŠ timeoutå­—æ®µ
const WaitForElementConfig = ({ params, onChange }) => {
  return (
    <div className="space-y-4">
      <div>
        <label className="block text-sm font-medium mb-1">é€‰æ‹©å™¨</label>
        <Input
          value={params.selector || ''}
          onChange={(e) => onChange({ ...params, selector: e.target.value })}
          placeholder="CSSé€‰æ‹©å™¨ï¼Œå¦‚ #submit-btn"
        />
      </div>
      
      <div>
        <label className="block text-sm font-medium mb-1">
          ç­‰å¾…è¶…æ—¶ï¼ˆç§’ï¼‰
        </label>
        <Input
          type="number"
          value={params.timeout ?? 30}
          onChange={(e) => onChange({ 
            ...params, 
            timeout: parseInt(e.target.value) 
          })}
          min={1}
          max={300}
        />
        <p className="text-xs text-gray-500 mt-1">
          å…ƒç´ æœªåœ¨æ­¤æ—¶é—´å†…å‡ºç°å°†æŠ¥é”™ï¼Œé»˜è®¤30ç§’
        </p>
      </div>
      
      <div className="flex items-center gap-2">
        <Switch
          checked={params.visible ?? true}
          onCheckedChange={(checked) => 
            onChange({ ...params, visible: checked })
          }
        />
        <label className="text-sm">è¦æ±‚å…ƒç´ å¯è§</label>
      </div>
    </div>
  )
}
```

---

## âœ… éªŒè¯æ¸…å•

### åŠŸèƒ½éªŒè¯

#### P0ä»»åŠ¡éªŒè¯
- [ ] **Task 1 (ç”¨æˆ·å¹²é¢„)**: 
  - åå°æ¨¡å¼ç‚¹å‡»"ç»§ç»­"åæ‰§è¡Œèƒ½æ­£å¸¸ç»§ç»­
  - å‰å°æ¨¡å¼å¼¹çª—åœ¨Playwrightæµè§ˆå™¨å†…æ‰“å¼€
  
- [ ] **Task 2 (AIå®šä½é‡æ„)**: 
  - è°ƒè¯•åŠŸèƒ½èƒ½æ­£ç¡®å®šä½å…ƒç´ å¹¶è¿”å›CSSé€‰æ‹©å™¨
  - ä¿å­˜çš„é€‰æ‹©å™¨èƒ½æ­£ç¡®æ‰§è¡Œ
  - CSSå¤±æ•ˆæ—¶AIåå¤‡èƒ½å¯åŠ¨ï¼ˆå½“å¼€å¯æ—¶ï¼‰
  - CSSå¤±æ•ˆæ—¶ç›´æ¥æŠ¥é”™ï¼ˆå½“å…³é—­åå¤‡æ—¶ï¼‰

#### P1ä»»åŠ¡éªŒè¯
- [ ] **Task 4 (åœæ­¢æŒ‰é’®)**: ç‚¹å‡»åœæ­¢åå·¥ä½œæµç«‹å³ç»ˆæ­¢
- [ ] **Task 10 (è¿æ¥çº¿)**: æ‰€æœ‰èŠ‚ç‚¹å·¦å³ä¸¤ä¾§éƒ½èƒ½æ‹–å‡ºè¿æ¥çº¿
- [ ] **Task 12 (æ¨¡å‹é…ç½®)**: 
  - å¯ä»¥ä»é…ç½®æ–‡ä»¶åŠ è½½æ¨¡å‹
  - ä¸åŒåœºæ™¯ä½¿ç”¨ä¸åŒæ¨¡å‹
  - æ”¯æŒé™çº§ç­–ç•¥

#### P2ä»»åŠ¡éªŒè¯
- [ ] **Task 5 (console)**: æ–°å»ºå·¥ä½œæµæ—¶æ§åˆ¶å°æ— æ®‹ç•™log
- [ ] **Task 6 (é»‘è¾¹)**: æ‰€æœ‰ä¾§è¾¹æ æ— é»‘è‰²è¾¹æ¡†
- [ ] **Task 7 (å¼¹çª—)**: å¼¹çª—æé†’å®Œå…¨åœ¨å¯è§†åŒºåŸŸå†…
- [ ] **Task 8 (æœ¯è¯­)**: æ‰€æœ‰"è¿è¡Œ"å·²æ›¿æ¢ä¸º"æ‰§è¡Œ"ï¼ˆé™¤è¡¨ç¤ºçŠ¶æ€å¤–ï¼‰
- [ ] **Task 11 (æ—¥å¿—)**: åç«¯æ‰§è¡Œæ—¶æœ‰æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°
- [ ] **Task 12 (ç­‰å¾…æ—¶é—´)**: ç­‰å¾…å…ƒç´ èŠ‚ç‚¹å¯é…ç½®è¶…æ—¶æ—¶é—´
- [ ] **Task 9 (ç›‘æ§æ‹–æ‹½)**: ç›‘æ§é¢æ¿å¯ä»¥æ‹–æ‹½è°ƒæ•´å¤§å°
- [ ] **Task 13 (æ— éšœç¢æ ‘)**: AIå®šä½ä½¿ç”¨æ— éšœç¢æ ‘è€ŒéHTML

### æŠ€æœ¯éªŒè¯

```bash
# 1. åç«¯è¯­æ³•æ£€æŸ¥
cd /Users/zwh/zwh/AICode/SchemaFlow/backend
python -m py_compile engine/ai_target_locator.py
python -m py_compile engine/ai_client.py
python -m py_compile config/ai_models.py

# 2. å‰ç«¯ç±»å‹æ£€æŸ¥
cd /Users/zwh/zwh/AICode/SchemaFlow/frontend
npx tsc --noEmit

# 3. å‰ç«¯æ„å»º
cd /Users/zwh/zwh/AICode/SchemaFlow/frontend
npm run build

# 4. ä»£ç è§„èŒƒæ£€æŸ¥
cd /Users/zwh/zwh/AICode/SchemaFlow/frontend
npm run lint
```

---

## ğŸ“ æ–‡ä»¶ä¿®æ”¹æ¸…å•

### æ–°å¢æ–‡ä»¶
1. `backend/engine/ai_target_locator.py` - AIç›®æ ‡å®šä½æ¨¡å—ï¼ˆé‡æ„ç‰ˆï¼‰
2. `backend/engine/ai_client.py` - ç»Ÿä¸€AIå®¢æˆ·ç«¯
3. `backend/config/ai_models.py` - æ¨¡å‹é…ç½®ç®¡ç†
4. `backend/config/ai_config.yaml` - AIæ¨¡å‹é…ç½®æ–‡ä»¶
5. `frontend/src/components/FlowEditor/DebugLocatorModal.tsx` - å®šä½è°ƒè¯•å¼¹çª—
6. `frontend/src/components/Settings/ModelConfig.tsx` - æ¨¡å‹é…ç½®ç•Œé¢

### ä¿®æ”¹æ–‡ä»¶
**åç«¯:**
1. `backend/engine/actions/ai_action.py` - ä½¿ç”¨æ··åˆå®šä½å™¨
2. `backend/engine/actions/control.py` - ç”¨æˆ·å¹²é¢„å’Œç­‰å¾…å…ƒç´ èŠ‚ç‚¹
3. `backend/engine/executor.py` - åœæ­¢æ‰§è¡Œå’ŒAIå®šä½é›†æˆ
4. `backend/engine/browser_manager.py` - å¼¹çª—ä½ç½®å¤„ç†
5. `backend/api/execution.py` - WebSocketæ¶ˆæ¯å¤„ç†
6. `backend/config.py` - æ—¥å¿—é…ç½®å’ŒAIé…ç½®åŠ è½½

**å‰ç«¯:**
1. `frontend/src/components/WorkflowList/index.tsx` - ç§»é™¤console
2. `frontend/src/components/FlowEditor/panels/NodePanel.tsx` - AIå®šä½é…ç½®
3. `frontend/src/components/FlowEditor/panels/Toolbar.tsx` - é»‘è¾¹æ ·å¼
4. `frontend/src/components/ExecutionPanel/index.tsx` - å¼¹çª—ä½ç½®å’Œæ‹–æ‹½è°ƒæ•´
5. `frontend/src/hooks/useExecution.ts` - åœæ­¢æ‰§è¡Œå’Œç”¨æˆ·å¹²é¢„
6. `frontend/src/components/FlowEditor/nodes/*.tsx` - è¿æ¥çº¿Handle
7. å…¨å±€æœ¯è¯­æ›¿æ¢ - å¤šä¸ªæ–‡ä»¶

---

## ğŸš€ éƒ¨ç½²è¯´æ˜

### å¼€å‘ç¯å¢ƒ
```bash
# 1. å®‰è£…æ–°ä¾èµ–
cd /Users/zwh/zwh/AICode/SchemaFlow/frontend
npm install re-resizable

# 2. å¯åŠ¨åç«¯
cd /Users/zwh/zwh/AICode/SchemaFlow/backend
python main.py

# 3. å¯åŠ¨å‰ç«¯
cd /Users/zwh/zwh/AICode/SchemaFlow/frontend
npm run dev
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
# 1. æ„å»ºå‰ç«¯
cd /Users/zwh/zwh/AICode/SchemaFlow/frontend
npm run build

# 2. éƒ¨ç½²åç«¯
cd /Users/zwh/zwh/AICode/SchemaFlow/backend
# ä½¿ç”¨gunicornæˆ–uvicornéƒ¨ç½²
uvicorn main:app --host 0.0.0.0 --port 8000
```

---

## ğŸ“ å¤‡æ³¨

1. **æ¨¡å‹é…ç½®æ–‡ä»¶**: é¦–æ¬¡éƒ¨ç½²æ—¶éœ€å¤åˆ¶ `ai_config.yaml.example` ä¸º `ai_config.yaml` å¹¶å¡«å…¥API Key
2. **ä¼˜å…ˆçº§å»ºè®®**: å…ˆå®ŒæˆP0ä»»åŠ¡ï¼Œç‰¹åˆ«æ˜¯AIå®šä½é‡æ„ï¼ˆTask 2ï¼‰å’Œç”¨æˆ·å¹²é¢„ä¿®å¤ï¼ˆTask 1ï¼‰
3. **æ¨¡å‹ç®¡ç†**: æ”¯æŒçƒ­æ›´æ–°æ¨¡å‹é…ç½®ï¼Œä¿®æ”¹yamlæ–‡ä»¶åæ— éœ€é‡å¯æœåŠ¡
4. **æˆæœ¬ä¼˜åŒ–**: é»˜è®¤ä½¿ç”¨gpt-4o-minié™ä½æˆæœ¬ï¼Œå¤æ‚ä»»åŠ¡è‡ªåŠ¨åˆ‡æ¢åˆ°gpt-4o
5. **æ— éšœç¢æ ‘**: æ¯”HTMLæ›´ç²¾ç®€ï¼Œtokenæ¶ˆè€—å‡å°‘çº¦60-70%ï¼Œå®šä½é€Ÿåº¦æ›´å¿«

---

**æ–‡æ¡£ç”Ÿæˆæ—¶é—´:** 2026-02-22  
**ç‰ˆæœ¬:** v0.5.1  
**ä½œè€…:** SchemaFlow Team
